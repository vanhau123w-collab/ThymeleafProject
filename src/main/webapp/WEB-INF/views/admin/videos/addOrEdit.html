<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <!-- Sử dụng '== true' để xử lý an toàn trường hợp null -->
    <title th:text="${isEdit == true ? 'Edit Video' : 'Add New Video'}">Video Form</title>
    
    <!-- Fonts & CSS -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #f8f9fa;
            display: flex; flex-direction: column; min-height: 100vh;
        }
        .main-content { flex: 1; }
        .card { border: none; border-radius: 15px; }
        .form-control:focus, .form-check-input:focus, .form-select:focus { 
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25); border-color: #dc3545; 
        }
        
        /* Khung xem trước Poster */
        .poster-preview { 
            width: 100%; max-height: 250px; object-fit: contain; 
            border: 2px dashed #ddd; border-radius: 8px; display: none; margin-top: 10px;
            background-color: #000;
        }
        .poster-preview.show { display: block; }
    </style>
</head>
<body>

    <!-- Gọi Header -->
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="container main-content mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <!-- FORM START -->
                <form th:action="@{/admin/videos/saveOrUpdate}" method="POST" th:object="${video}">
                    
                    <div class="card shadow-lg">
                        <!-- Header Card -->
                        <div class="card-header text-white py-3" 
                             th:classappend="${isEdit == true ? 'bg-warning' : 'bg-danger'}">
                            <h4 class="mb-0">
                                <i th:class="${isEdit == true ? 'fas fa-edit' : 'fas fa-video'}"></i>
                                <span th:text="${isEdit == true ? ' Edit Video Details' : ' Upload New Video'}"></span>
                            </h4>
                        </div>
                        
                        <div class="card-body p-4">
                            <!-- Video ID -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Video ID</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-fingerprint"></i></span>
                                    <input type="text" class="form-control bg-light" th:field="*{videoId}" 
                                           placeholder="Auto Generated ID" readonly>
                                </div>
                                <small class="text-muted fst-italic">ID cannot be changed.</small>
                            </div>

                            <!-- Title -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Video Title</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-heading"></i></span>
                                    <input type="text" class="form-control" th:field="*{title}" 
                                           placeholder="Enter video title" required>
                                </div>
                            </div>

                            <!-- Poster URL & Preview -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Poster URL</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-image"></i></span>
                                    <input type="text" class="form-control" th:field="*{poster}" 
                                           id="posterInput" placeholder="Paste image link here" 
                                           oninput="updatePosterPreview()">
                                </div>
                                <!-- Ảnh xem trước -->
                                <div class="text-center">
                                    <img id="posterPreview" class="poster-preview" alt="Poster Preview">
                                </div>
                            </div>
                            
                            <!-- Category Dropdown -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Category</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-folder"></i></span>
                                    <!-- Giả sử trong Entity Video có quan hệ ManyToOne với Category tên là 'category' -->
                                    <select class="form-select" th:field="*{category.id}" required>
                                        <option value="">-- Select Category --</option>
                                        <option th:each="item : ${categories}" 
                                                th:value="${item.id}" 
                                                th:text="${item.categoryName}">Category Name</option>
                                    </select>
                                </div>
                            </div>

                            <!-- Views (Readonly) -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Views</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-eye"></i></span>
                                    <input type="number" class="form-control bg-light" th:field="*{views}" 
                                           placeholder="0" readonly>
                                </div>
                            </div>

                            <!-- Description -->
                            <div class="mb-3">
                                <label class="form-label fw-bold">Description</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-align-left"></i></span>
                                    <textarea class="form-control" th:field="*{description}" rows="4" 
                                              placeholder="Enter video description..."></textarea>
                                </div>
                            </div>

                            <!-- Active Switch -->
                            <div class="mb-3 mt-4 p-3 border rounded bg-light">
                                <div class="form-check form-switch d-flex align-items-center">
                                    <input class="form-check-input me-3" type="checkbox" id="activeSwitch" 
                                           th:field="*{active}" style="width: 3em; height: 1.5em; cursor: pointer;">
                                    <div>
                                        <label class="form-check-label fw-bold" for="activeSwitch">Active Status</label>
                                        <div class="form-text text-muted">Enable to make this video public.</div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        
                        <!-- Footer Buttons -->
                        <div class="card-footer bg-light p-3 d-flex justify-content-between">
                            <a th:href="@{/admin/videos}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to List
                            </a>
                            
                            <div>
                                <a th:href="@{/admin/videos/add}" class="btn btn-outline-secondary me-2">
                                    <i class="fas fa-sync-alt"></i> Reset
                                </a>
                                <button type="submit" class="btn btn-danger px-4 fw-bold">
                                    <i class="fas fa-save"></i> Save Video
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Gọi Footer -->
    <div th:replace="~{fragments/footer :: footer}"></div>

    <!-- Script xử lý ảnh xem trước -->
    <script>
        function updatePosterPreview() {
            const url = document.getElementById('posterInput').value;
            const img = document.getElementById('posterPreview');
            if (url && url.trim() !== "") {
                img.src = url;
                img.classList.add('show');
                img.onerror = function() { img.classList.remove('show'); };
            } else {
                img.classList.remove('show');
            }
        }
        // Chạy khi tải trang
        window.onload = updatePosterPreview;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>