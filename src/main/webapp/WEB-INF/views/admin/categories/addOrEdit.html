<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${category.isEdit ? 'Edit Category' : 'Add New Category'}">Category Form</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* CSS để trang web co giãn, footer luôn ở đáy */
        body { 
            font-family: 'Poppins', sans-serif; 
            background-color: #f8f9fa; 
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        .main-content {
            flex: 1; /* Đẩy footer xuống dưới cùng */
        }
        
        .card { border: none; border-radius: 15px; }
        .form-control:focus { box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.15); }
        
        /* Khung xem trước ảnh */
        .preview-image { 
            max-width: 100%; height: 200px; object-fit: contain; 
            border: 2px dashed #ddd; border-radius: 8px; display: none; margin-top: 10px;
        }
        .preview-image.show { display: block; }
    </style>
</head>
<body>

    <div th:replace="~{fragments/header :: header}"></div>

    <div class="container main-content">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <form th:action="@{/admin/categories/saveOrUpdate}" method="POST" th:object="${category}">
                    
                    <div class="card shadow-lg mt-4">
                        <div class="card-header bg-gradient text-white py-3" 
                             th:classappend="${category.isEdit ? 'bg-warning' : 'bg-primary'}">
                            <h4 class="mb-0">
                                <i th:class="${category.isEdit ? 'fas fa-edit' : 'fas fa-plus-circle'}"></i>
                                <span th:text="${category.isEdit ? 'Edit Category' : 'Add New Category'}">Form</span>
                            </h4>
                        </div>
                        
                        <div class="card-body p-4">
                            <input type="hidden" th:field="*{isEdit}">

                            <div class="mb-3">
                                <label for="categoryId" class="form-label fw-bold">Category ID</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-id-card"></i></span>
                                    <input type="text" class="form-control bg-light" 
                                           th:field="*{id}" id="categoryId" 
                                           readonly placeholder="Auto Generated ID">
                                </div>
                                <small class="text-muted fst-italic">ID is automatically generated.</small>
                            </div>

                            <div class="mb-3">
                                <label for="categoryName" class="form-label fw-bold">Category Name</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-tag"></i></span>
                                    <input type="text" class="form-control" 
                                           th:field="*{categoryName}" id="categoryName" 
                                           placeholder="Enter category name" required>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="images" class="form-label fw-bold">Image URL</label>
                                <div class="input-group">
                                    <span class="input-group-text"><i class="fas fa-image"></i></span>
                                    <input type="text" class="form-control" 
                                           th:field="*{images}" id="images" 
                                           placeholder="Paste image URL here" 
                                           oninput="updateImagePreview()">
                                </div>
                                <div class="text-center">
                                    <img id="imgPreview" class="preview-image" alt="Image Preview">
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-footer bg-light p-3 d-flex justify-content-between">
                            <a th:href="@{/admin/categories}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left"></i> Back to List
                            </a>
                            
                            <div>
                                <a th:href="@{/admin/categories/add}" class="btn btn-outline-info me-2">
                                    <i class="fas fa-sync-alt"></i> Reset
                                </a>
                                <button class="btn btn-primary fw-bold px-4" type="submit">
                                    <i class="fas fa-save"></i> 
                                    <span th:text="${category.isEdit ? 'Update' : 'Save'}">Save</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div th:replace="~{fragments/footer :: footer}"></div>

    <script>
        function updateImagePreview() {
            const url = document.getElementById('images').value;
            const img = document.getElementById('imgPreview');
            if (url && url.trim() !== "") {
                img.src = url;
                img.classList.add('show');
                
                // Xử lý nếu ảnh lỗi (404)
                img.onerror = function() {
                    img.classList.remove('show');
                };
            } else {
                img.classList.remove('show');
            }
        }
        // Chạy ngay khi tải trang (để hiện ảnh nếu đang ở chế độ Edit)
        window.onload = updateImagePreview;
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>